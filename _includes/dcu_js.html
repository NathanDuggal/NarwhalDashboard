<script>
    var left_PID, right_PID;
    var left_ids, right_ids;

    function initDCU() {
        left_ids = ['l_f', 'l_mp_p', 'l_mp_i', 'l_mp_d', 'l_v_p', 'l_v_i', 'l_v_d'];
        right_ids = ['r_f', 'r_mp_p', 'r_mp_i', 'r_mp_d', 'r_v_p', 'r_v_i', 'r_v_d'];

        left_PID =  [-1, -1, -1, -1, -1, -1, -1];
        right_PID = [-1, -1, -1, -1, -1, -1, -1];
    }

    function updateDCU() {
        updatePID(json);

        setNumber('wheelCirc', 2);

        setNumber('left_max_speed', 0);
        setNumber('right_max_speed', 0);

        setNumber('leftSpeedScalar', 3);
        setNumber('rightSpeedScalar', 3);

        setNumber('avg_wb', 2);
        setNumber('prev_wb', 1);

        setNumber('avg_w', 2);
        setNumber('avg_ffpmL', 6);
        setNumber('avg_ffpmR', 6);
    }

    function updatePID(json) {
        for (var i = 0; i < 7; i++) {
            if (left_PID[i] != json[left_ids[i]]) {
                left_PID[i] = json[left_ids[i]];
                getElement(left_ids[i]).value = Number(left_PID[i]).toFixed(4);
            }

            if (right_PID[i] != json[right_ids[i]]) {
                right_PID[i] = json[right_ids[i]];
                getElement(right_ids[i]).value = Number(right_PID[i]).toFixed(4);
            }
        }
    }

function pushLeftPID() {
    sendNum('leftPID', getPIDConstants(left_ids));
}

function pushRightPID() {
    sendNum('rightPID', getPIDConstants(right_ids));
}

function getPIDConstants(field_ids) {
    var data = "";

    for (var i = 0; i < field_ids.length; i++) {
        data += getElement(field_ids[i]).value;

        if (i != field_ids.length - 1) {
            data += ',';
        }
    }

    return data;
}

function wheelbase() {
    sendNum('calc_wb', getElement('l_pow').value + ',' + getElement('r_pow').value + ',' + getElement('wb_dur').value);
}
function ffpCalibration() {
    sendNum('calc_ffp', getElement('l_pow_ffp').value + ',' + getElement('r_pow_ffp').value + ',' + getElement('ffp_dur').value);
}

</script>
